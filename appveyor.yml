cache:
  - C:\Users\appveyor\.conan\data

environment:
  global:
    TWINE_USERNAME: d0m3nik
    CIBW_BEFORE_BUILD: "pip install -r requirements_dev.txt && python install_conan_packages.py"
    CIBW_SKIP: "cp27-*"
    CIBW_TEST_REQUIRES: nose
    CIBW_TEST_COMMAND: "nosetests {project}\\test"
  matrix:
    - CIBW_BUILD: "cp34-*"
    - CIBW_BUILD: "cp35-*"
    - CIBW_BUILD: "cp36-*"
    - CIBW_BUILD: "cp37-*"

build_script:
  - pip install cython
  - python generate.py
  - pip install cibuildwheel==0.10.0
  - cibuildwheel --output-dir wheelhouse

artifacts:
  - path: "wheelhouse\\*.whl"
    name: Wheels


# init:
#   - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))


on_success:
  # Deploy to PyPI on tag
  - >
    IF "%APPVEYOR_REPO_TAG%" == "true"
    (
    "%PYTHON%\\python.exe" -m pip install twine
    &&
    "%PYTHON%\\python.exe" -m twine upload wheelhouse/*.whl
    )

# vvv Enable for debugging on appveyor build worker vvv
#on_finish:
#  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
